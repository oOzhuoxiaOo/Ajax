<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯·æ±‚è¶…æ—¶å’Œç½‘ç»œå¼‚å¸¸</title>
    <style>
        #result {
            width: 200px;
            height: 100px;
            border: solid #90b;
        }
    </style>
</head>
<body>
    <button>ç‚¹å‡»å‘é€è¯·æ±‚</button>
    <div id="result"></div>

    <script>
        // è·å–ç‚¹å‡»æŒ‰é’® å’Œ å†…å®¹åŒºåŸŸ
        const btn = document.querySelector('button');
        const result = document.querySelector('#result');
        // æ·»åŠ ç‚¹å‡»äº‹ä»¶
        btn.addEventListener('click',function(){
            // 1.è·å–XMLHttpRequest å¯¹è±¡
            const xhr = new XMLHttpRequest();
               // ğŸ”–è¶…æ—¶è®¾ç½® 2sè®¾ç½®
               xhr.timeout = 2000;
            //    ğŸ”–è¶…æ—¶å›è°ƒ
            xhr.ontimeout = function(){
                alert('ç½‘ç»œè¶…æ—¶2s,è¯·ä»æ–°è®¿é—®');
            }
            // ğŸ”–ç½‘ç»œå¼‚å¸¸å›è°ƒ
            xhr.onerror = function() {
                alert('ç½‘ç»œå¼‚å¸¸,å‡ºé—®é¢˜äº†');
            }
               //ğŸ”–å°†è·å–çš„å­—ç¬¦ä¸²æ ¼å¼ è½¬åŒ–ä¸ºå¯¹è±¡ 
               xhr.responseType = 'json';
            // 2.æ‰“å¼€è¿æ¥
            xhr.open('GET','http://127.0.0.1:8000/delay');
            // 3.å‘é€è¿æ¥
            xhr.send();
            // 4.ç»‘å®šæ¥æ”¶äº‹ä»¶
            xhr.onreadystatechange = function(){
                // ğŸ”–å‡†å¤‡çŠ¶æ€åˆ¤æ–­
                if(xhr.readyState === 4) {
                    console.log('å‡†å¤‡çŠ¶æ€åˆ¤æ–­æˆåŠŸ');
                    // çŠ¶æ€ç åˆ¤æ–­
                    if(xhr.status >= 200 && xhr.status < 300) {
                        console.log('çŠ¶æ€ç åˆ¤æ–­æˆåŠŸ')
                        // å†…å®¹
                        console.log('æ£€æµ‹responseå†…å®¹');
                        console.log(xhr.response);
                        result.innerHTML = xhr.response.name;
                        
                    }
                }
            }

        })
        
    </script>
</body>
</html>